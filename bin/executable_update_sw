#!/usr/bin/env zsh
UPDATE_SW_DIR="$HOME"
CURRENT_DIR=$(pwd)
INSTALLED_CONFIG=${HOME}/.local/personal_config
mkdir -p "${INSTALLED_CONFIG}"

echo "*** App Store programs"
echo
sudo mas outdated
sudo mas upgrade

echo "*** Homebrew"
echo
rm -f "${INSTALLED_CONFIG}/homebrew_packages"
brew list --versions > "${INSTALLED_CONFIG}/homebrew_packages"
brew doctor
brew update
brew upgrade
brew upgrade --cask

echo "*** Cargo"
echo
cargo install-update -a

echo "*** uv"
echo
uv tool upgrade

echo "*** Neovim"
echo
brew uninstall neovim && brew uninstall --ignore-dependencies luajit && brew install luajit && brew install --HEAD neovim
brew cleanup
nvim -c 'autocmd User PackerComplete quitall' -c 'PackerSync'
nvim -c 'autocmd User MasonUpdateAllComplete quitall' -c 'MasonUpdateAll'

echo "*** Updating completions"
echo
rm -f "${HOME}/.cache/zcompcache*"
if [[ ! -d "${HOME}/.local/completions" ]]; then
    mkdir -p "${HOME}/.local/completions"
fi
atuin init zsh >! "${HOME}/.local/completions/_atuin"
zoxide init zsh >! "${HOME}/.local/completions/_zoxide"
uv generate-shell-completion zsh >! "${HOME}/.local/completions/_uv"

echo "*** tmux plugins"
echo
"${HOME}/.tmux/plugins/tpm/bin/update_plugins" all
